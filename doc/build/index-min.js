/*!build time : 2014-07-30 9:48:18 AM*/
KISSY.add("kg/reflection/2.0.0/index",function(a,b,c){function d(a){var b=this;d.superclass.constructor.call(b,a)}function e(b,c){b.complete?c():a.Event.on(b,"load",c)}var f=a.DOM;return a.extend(d,c,{render:function(){var b=this,c=f.query(b.get("selector"));a.each(c,function(a){e(a,function(){var c=parseFloat(f.attr(a,"data-rheight"))||b.get("height"),d=parseFloat(f.attr(a,"data-ropacity"))||b.get("opacity");b.add(a,{height:c,opacity:d})})})},add:function(a,b){this.remove(a);var c=f.create("<canvas></canvas>");"getContext"in c?this.renderByCanvas(c,a,b):this.renderByFilter(a,b)},renderByCanvas:function(a,b,c){var d=f.create("<div></div>"),e=b,g=e.className,h=Math.floor(e.height*c.height),i=Math.floor(e.height*(1+c.height)),j=e.width;d.className=g,e.className="reflected",d.style.cssText=e.style.cssText,e.style.cssText="vertical-align: bottom",a.height=h,a.width=j,d.style.width=j+"px",d.style.height=i+"px",e.parentNode.replaceChild(d,e),d.appendChild(e),d.appendChild(a);var k=a.getContext("2d");k.save(),k.translate(0,e.height-1),k.scale(1,-1),k.drawImage(e,0,0,j,e.height),k.restore(),k.globalCompositeOperation="destination-out";var l=k.createLinearGradient(0,0,0,h);l.addColorStop(0,"rgba(255, 255, 255, "+(1-c.opacity)+")"),l.addColorStop(1,"rgba(255, 255, 255, 1.0)"),k.fillStyle=l,k.rect(0,0,j,h),k.fill()},renderByFilter:function(a,b){var c=f.create("<div></div>"),d=a,e=d.className,g=Math.floor(d.height*b.height),h=Math.floor(d.height*(1+b.height)),i=d.width;"A"==d.parentElement.tagName&&(c=f.create("<a></a>"),c.href=d.parentElement.href),c.className=e,d.className="reflected",c.style.cssText=d.style.cssText,d.style.cssText="vertical-align: bottom";var j=new Image;j.onload=function(){j.style.width=i+"px",j.style.display="block",j.style.height=d.height+"px",j.style.marginBottom="-"+(d.height-g)+"px";var a="flipv progid:DXImageTransform.Microsoft.Alpha(opacity="+100*b.opacity+", style=1, finishOpacity=0, startx=0, starty=0, finishx=0, finishy="+100*b.height+")";j.style.filter=a,c.style.width=i+"px",c.style.height=h+"px",d.parentNode.replaceChild(c,d),c.appendChild(d),c.appendChild(j)},j.src=d.src},removeAll:function(){var b=f.query(".reflected"),c=this;a.each(b,function(a){c.remove(a)})},remove:function(a){a=f.get(a),a&&"reflected"==a.className&&(a.className=a.parentNode.className,a.parentNode.parentNode.replaceChild(a,a.parentNode))}},{ATTRS:{height:{value:.5},opacity:{value:.5},selector:{value:".reflect"}}}),d},{requires:["node","base"]});